<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Akela Toolbox</title>
  <meta name="description" content="Akela Toolbox - GÃ©nÃ©rateur d'activitÃ©s et gestion collaborative de jeux Louveteaux.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="Akela Toolbox" />
  <meta property="og:description" content="Facilitez la prÃ©paration d'activitÃ©s Louveteaux grÃ¢ce Ã  des outils intelligents et une base collaborative de jeux." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://josephhumbert.github.io/AkelaToolbox/" />
  <link rel="stylesheet" href="https://josephhumbert.github.io/AkelaToolbox/style.css">
</head>

<body>

  <h1>ğŸº Akela Toolbox</h1>

  <nav>
    <button data-target="home">Accueil</button>
    <button data-target="list">ğŸ“š Liste  jeux</button>
    <button data-target="generator">ğŸ›  AkelaAI</button>
    <button data-target="submit">ğŸ†• Nouveau jeu</button>
    <button onclick="window.location.href='https://josephhumbert.github.io/AkelaToolbox/contact.html'">ğŸ“¬ Contact</button>
  </nav>
  
<!-- Accueil -->
<section id="home" class="active">
  <h2>ğŸ¾ Bienvenue sur Akela Toolbox !</h2>

  <p>
    Ce site est un outil collaboratif pensÃ© pour les chefs Louveteaux. Il facilite la prÃ©paration, la crÃ©ation et le partage de jeux d'animation.
  </p>

  <h3>âœ¨ FonctionnalitÃ©s principales</h3>

  <ul>
    <li>ğŸ“š <u><strong data-target="list" class="nav-link">Explorer</strong></u> une liste de jeux Louveteaux</li>
    <li>ğŸ” <u><strong data-target="list" class="nav-link">Rechercher</strong></u> rapidement un jeu dans la liste</li>
    <li>ğŸ›  <u><strong data-target="generator" class="nav-link">GÃ©nÃ©rer automatiquement</strong></u> un programme dâ€™activitÃ©s avec <em>AkelaAI</em>, Ã  partir de vos besoins</li>
    <li>ğŸ†• <u><strong data-target="submit" class="nav-link">Soumettre un nouveau jeu</strong></u> via un formulaire simple, pour enrichir la base de donnÃ©es collective</li>
    <li>ğŸ“¬ <u><strong><a href="https://josephhumbert.github.io/AkelaToolbox/contact.html">Nous contacter</a></strong></u> pour signaler un bug ou proposer une amÃ©lioration</li>
  </ul>

  <h3>ğŸ“– L'histoire du projet</h3>
  <p>
    Akela Toolbox est nÃ© dâ€™un constat sur le terrain : les chefs ont souvent peu de temps pour prÃ©parer leurs activitÃ©s, et les ressources sont dispersÃ©es ou obsolÃ¨tes.  
    Nous avons donc conÃ§u un outil simple, rapide et collaboratif.
  </p>
  <p>
    Dâ€™abord utilisÃ© dans un cercle scout restreint, le site sâ€™est Ã©toffÃ© avec lâ€™ajout dâ€™une base de donnÃ©es dynamique (via Google Sheets) et dâ€™un gÃ©nÃ©rateur de programmes intelligent grÃ¢ce Ã  <strong>AkelaAI</strong>, un assistant basÃ© sur un modÃ¨le de langage.
  </p>
  <p>
    Ce projet reste libre et communautaire. Chaque contribution (jeu, retour, idÃ©e) est prÃ©cieuse et aide Ã  construire un outil utile pour tous les chefs de meute. Merci dâ€™en faire partie !
  </p>
</section>


  <!-- Liste des jeux -->
  <section id="list">
    <h2>ğŸ“š Liste des jeux Louveteaux</h2>
    <input id="search" type="text" placeholder="ğŸ” Rechercher par mot-clÃ©" />
    <table>
      <thead>
        <tr><th>Nom</th><th>DurÃ©e</th><th>MatÃ©riel</th><th>Objectif</th><th>Description</th></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </section>

  <!-- GÃ©nÃ©rateur de programmes -->
<section id="generator">
  <h2>ğŸ’¬ AkelaAI (Powered by Mistral)</h2>

  <p>Ce modÃ¨le permet de gÃ©nÃ©rer des emplois du temps pour vos activitÃ©s. Plus votre demande est dÃ©taillÃ©e meilleure sera sa rÃ©ponse. Les jeux proposÃ©s viennent de la base de donnÃ©es collaborative d'Akela Toolbox (Onglet Liste jeux).</p>

  <textarea id="userPrompt" rows="5" placeholder="Ex : GÃ©nÃ¨re un programme du samedi 10h au dimanche 16h, thÃ¨me jungle, objectif cohÃ©sion, trajet 30 min" disabled></textarea>
  <button id="sendBtn" disabled>Chargement des jeux...</button>

  <h2>ğŸ§  RÃ©ponse :</h2>
  <div id="program-output">En attente...</div>

</section>


  <!-- Soumission nouveau jeu -->
  <section id="submit">
    <h2>â• Soumettre un nouveau jeu</h2>
    <form id="submit-form">
      <label>Nom: <input type="text" id="new-name" required></label>
      <label>DurÃ©e (min): <input type="number" id="new-duration" required></label>
      <label>MatÃ©riel: <input type="text" id="new-material" required></label>
      <label>Objectif: <input type="text" id="new-goal" required></label>
      <label>Description: <textarea id="new-description" rows="4" required></textarea></label>
      <button type="submit" class="submit-btn">Envoyer</button>
    </form>
    <div id="submit-result" style="margin-top: 1rem;">Cliquez sur envoyer pour ajouter votre jeu a la base de donnÃ©es.</div>
  </section>

  <footer>
  <p>Â© 2025 Akela Toolbox â€“ Un projet scout libre. | <a href="https://josephhumbert.github.io/AkelaToolbox/mentions-legales.html">Mentions lÃ©gales</a></p>
  </footer>

  <script>
  // Navigation simple
  const navElements = document.querySelectorAll("[data-target]");
  const sections = document.querySelectorAll("section");

  navElements.forEach(el => {
    el.addEventListener("click", () => {
      const target = el.dataset.target;
      sections.forEach(sec => {
        sec.classList.toggle("active", sec.id === target);
      });
    });
  });

  // DonnÃ©es CSV depuis Google Sheets
  const csvUrl = "https://docs.google.com/spreadsheets/d/10uIzf1QjEqgZn9OCvxaONA5va1T8xgT8p40eCXftSec/export?format=csv&gid=0";

  // Parser CSV
  function parseCSV(text) {
    const lines = text.trim().split("\n");
    const headers = lines.shift().split(",").map(h => h.trim());
    return lines.map(line => {
      const values = line.split(",").map(v => v.trim());
      let obj = {};
      headers.forEach((h, i) => {
        obj[h] = values[i] || "";
      });
      return obj;
    });
  }

  // Render jeux + recherche
  const tbody = document.getElementById("tbody");
  const searchInput = document.getElementById("search");
  let rows = [];

  function render(data) {
    tbody.innerHTML = "";
    if (data.length === 0) {
      tbody.innerHTML = "<tr><td colspan='5'>Aucun rÃ©sultat trouvÃ©.</td></tr>";
      return;
    }
    for (const row of data) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.Nom}</td>
        <td>${row.DurÃ©e}</td>
        <td>${row.MatÃ©riel}</td>
        <td>${row.Objectif}</td>
        <td>${row.Description}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  fetch(csvUrl)
    .then(res => res.text())
    .then(text => {
      rows = parseCSV(text);
      render(rows);
    })
    .catch(() => {
      tbody.innerHTML = "<tr><td colspan='5'>Erreur de chargement des donnÃ©es.</td></tr>";
    });

  searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase();
    const filtered = rows.filter(row =>
      Object.values(row).some(val => val.toLowerCase().includes(query))
    );
    render(filtered);
  });

  // GÃ©nÃ©rateur de programmes
  // On conserve les fonctions parseCSV et la variable csvUrl ainsi que la rÃ©cupÃ©ration des jeux dans rows

let games = [];  // on utilisera games pour la base complÃ¨te

// Charger et parser la base CSV (remplace fetch csvUrl dans la partie list aussi, pour Ã©viter double fetch)
fetch(csvUrl)
  .then(res => res.text())
  .then(text => {
    games = parseCSV(text);
    render(rows); // On continue dâ€™afficher la liste comme avant (rows === games)
    
    // AprÃ¨s chargement, activer textarea + bouton dans la section gÃ©nÃ©rateur
    const sendBtn = document.getElementById("sendBtn");
    const userPrompt = document.getElementById("userPrompt");
    sendBtn.disabled = false;
    sendBtn.textContent = "Envoyer Ã  AkelaAI";
    userPrompt.disabled = false;
  })
  .catch(() => {
    tbody.innerHTML = "<tr><td colspan='5'>Erreur de chargement des donnÃ©es.</td></tr>";
    alert("Impossible de charger les jeux. RÃ©essayez plus tard.");
  });

// PrÃ©fixe prompt IA
const PREFIX_PROMPT = `Tu es un assistant scout expert dans lâ€™organisation dâ€™activitÃ©s pour les Louveteaux.

Ton rÃ´le est de gÃ©nÃ©rer des programmes dÃ©taillÃ©s pour des week-ends ou journÃ©es scoutes, selon des paramÃ¨tres donnÃ©s par un chef.

Les jeux que tu inclus proviennent uniquement de la base de donnÃ©es fournie et les timings sont coherents.

horaires imposes:
- Montage des tentes en debut d'apres midi
- 60 minutes de preparation du diner/de la veillee
- Le dÃ®ner dure 60 minutes.
- La veillÃ©e dure 90 minutes.
- Le coucher est toujours Ã  21h00 maximum. Si une activitÃ© dÃ©passe, elle est coupÃ©e.
- Dodo de 21h00 Ã  8h15.
- 08h15â€“08h30 : RÃ©veil et dÃ©rouillage (15 min)
- 08h30â€“09h15 : Petit dÃ©jeuner (45 min)
- 09h15â€“09h45 : DÃ©sinstallation (30 min)
- Rassemblement final 10 minutes a la fin du weekend
- JAMAIS DE TEMPS LIBRE SAUF POUR LE SOMMEIL LA NUIT

Tes rÃ©ponses sont toujours trÃ¨s brÃ¨ves (sauf pour les jeux dont tu fais une description copiee collee de la base de donnees) et en texte pur.

Commence maintenant avec le prompt utilisateur suivant :
`;

const API_KEY = "ySiMyJNfTK46OI3TYjDsu1wUqYGBvXeN";

async function sendPrompt() {
  const userInput = document.getElementById("userPrompt").value.trim();
  if (!userInput) {
    alert("Veuillez saisir un prompt.");
    return;
  }

  const programOutput = document.getElementById("program-output");
  programOutput.textContent = "â³ Chargement...";

  try {
    // Construire prompt complet
    const gamesString = JSON.stringify(games, null, 2);
    const fullPrompt = `${PREFIX_PROMPT}\nBase de donnÃ©es jeux :\n${gamesString}\n\n${userInput}`;

    const res = await fetch("https://api.mistral.ai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "mistral-medium",
        messages: [{ role: "user", content: fullPrompt }],
        temperature: 0.7
      })
    });

    if (!res.ok) throw new Error("Erreur HTTP : " + res.status);
    const data = await res.json();
    const reply = data.choices?.[0]?.message?.content || "âŒ Pas de rÃ©ponse.";

    programOutput.textContent = reply;

  } catch (err) {
    console.error(err);
    programOutput.textContent = "âŒ Erreur lors de l'appel Ã  l'API.";
  }
}

// Lier lâ€™Ã©vÃ©nement au bouton
document.getElementById("sendBtn").addEventListener("click", sendPrompt);


  // Soumission nouveau jeu en GET avec params dans l'URL
  const submitForm = document.getElementById("submit-form");
  const submitResult = document.getElementById("submit-result");

  // Soumission nouveau jeu via SheetDB (POST JSON)
submitForm.addEventListener("submit", async e => {
  e.preventDefault();

  const data = {
    Nom: submitForm["new-name"].value.trim(),
    DurÃ©e: submitForm["new-duration"].value.trim(),
    MatÃ©riel: submitForm["new-material"].value.trim(),
    Objectif: submitForm["new-goal"].value.trim(),
    Description: submitForm["new-description"].value.trim(),
  };

  try {
    const response = await fetch("https://sheetdb.io/api/v1/dtoqbws6n5hif", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ data })
    });

    if (!response.ok) throw new Error(`Erreur HTTP : ${response.status}`);

    submitResult.textContent = "âœ… Merci ! Jeu soumis avec succÃ¨s.";
    submitForm.reset();
    submitResult.textContent = "âœ… Merci ! Jeu soumis avec succÃ¨s.";
// Bloquer l'Ã©cran (optionnel, par exemple en dÃ©sactivant le formulaire ou en affichant un overlay)
submitForm.querySelectorAll("input, textarea, button").forEach(el => el.disabled = true);

// Attendre 2 secondes puis rafraÃ®chir la page
setTimeout(() => {
  location.reload();
}, 2000);

  } catch (err) {
    submitResult.textContent = "âŒ Erreur rÃ©seau ou serveur : " + err.message;
  }
});

  </script>

</body>
</html>
